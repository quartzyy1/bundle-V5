<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reco Bundle ‚Äì Scoring v2.2</title>
  <style>
    :root{--bg:#0b0c10;--panel:#151821;--muted:#9aa3b2;--text:#e6e9ef;--accent:#6ee7b7;--accent2:#60a5fa;--warn:#fbbf24;}
    *{box-sizing:border-box}
    body{margin:0;padding:24px;background:linear-gradient(180deg,#0b0c10,#111827 40%,#0b0c10);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text)}
    h1{font-size:22px;margin:0 0 16px}
    small, label, .hint{color:var(--muted)}
    .grid{display:grid;gap:16px}
    .two{grid-template-columns:1fr 1fr}
    .panel{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.08);backdrop-filter: blur(6px);border-radius:16px;padding:16px}
    select, input[type="text"], .chips{width:100%;border-radius:12px;border:1px solid rgba(255,255,255,0.12);background:#0f1220;color:var(--text);padding:10px 12px}
    .chips{display:flex;flex-wrap:wrap;gap:8px;padding:10px;border-style:dashed}
    .chip{display:inline-flex;gap:8px;align-items:center;padding:6px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.15);background:rgba(255,255,255,0.06);font-size:12px;cursor:pointer}
    .chip input{margin:0}
    button{appearance:none;border:0;border-radius:12px;padding:12px 16px;font-weight:600;cursor:pointer}
    .primary{background:linear-gradient(135deg,var(--accent),var(--accent2));color:#0b0c10}
    .muted{background:#1f2433;color:var(--text)}
    .stack{display:flex;gap:10px;flex-wrap:wrap}
    .scores{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .card{background:#0f1220;border:1px solid rgba(255,255,255,0.1);border-radius:14px;padding:12px}
    .k{font-size:11px;color:var(--muted)}
    .v{font-size:18px;font-weight:700}
    .rec{border-left:4px solid var(--accent);padding-left:12px}
    .badg{display:inline-block;padding:4px 8px;border-radius:999px;background:rgba(110,231,183,0.1);border:1px solid rgba(110,231,183,0.4);color:var(--accent);font-size:12px}
    .warn{background:rgba(251,191,36,0.12);border:1px solid rgba(251,191,36,0.45);color:#fde68a}
    .foot{opacity:.8;font-size:12px;margin-top:8px}
    @media(max-width:1000px){.scores{grid-template-columns:1fr 1fr 1fr}}
    @media(max-width:640px){.two{grid-template-columns:1fr}.scores{grid-template-columns:1fr 1fr}}
  </style>
</head>
<body>
  <h1>üîé Recommandation Bundle ‚Äì Scoring v2.2</h1>
  <p class="hint">Remplis le formulaire, puis clique sur <b>G√©n√©rer la reco</b>. Le moteur calcule un score par produit et propose un bundle adapt√©, avec explications.</p>

  <div class="grid two">
    <div class="panel">
      <h3>Formulaire</h3>
      <div class="grid two">
        <div>
          <label>Secteur</label>
          <select id="secteur">
            <option>Sant√©</option>
            <option>Industrie</option>
            <option>Finance</option>
            <option>√âducation</option>
            <option>Administration</option>
            <option>Commerce</option>
            <option>BTP</option>
            <option>Transport</option>
            <option>√ânergie</option>
            <option>Autre</option>
          </select>
        </div>
        <div>
          <label>Taille</label>
          <select id="taille">
            <option>1-10</option>
            <option>11-50</option>
            <option>51-100</option>
            <option>101-250</option>
            <option>250-1000</option>
            <option>1000+</option>
          </select>
        </div>
        <div>
          <label>Maturit√© cyber</label>
          <select id="maturite">
            <option>Faible</option>
            <option>Moyenne</option>
            <option>√âlev√©e</option>
          </select>
        </div>
        <div>
          <label>Budget</label>
          <select id="budget">
            <option>Faible</option>
            <option>Moyen</option>
            <option>√âlev√©</option>
          </select>
        </div>
        <div>
          <label>Contraintes r√©glementaires</label>
          <select id="contraintes"><option>Non</option><option>Oui</option></select>
        </div>
        <div>
          <label>Multi-sites / prestataires</label>
          <select id="multi"><option>Non</option><option>Oui</option></select>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>Pain points</label>
        <div class="chips" id="pp">
          <label class="chip"><input type="checkbox" value="Phishing"> Phishing</label>
          <label class="chip"><input type="checkbox" value="Fraude"> Fraude</label>
          <label class="chip"><input type="checkbox" value="Conformit√©"> Conformit√©</label>
          <label class="chip"><input type="checkbox" value="Acc√®s partag√©s"> Acc√®s partag√©s</label>
          <label class="chip"><input type="checkbox" value="Sensibilisation"> Sensibilisation</label>
          <label class="chip"><input type="checkbox" value="Gouvernance"> Gouvernance</label>
          <label class="chip"><input type="checkbox" value="Ransomware"> Ransomware</label>
          <label class="chip"><input type="checkbox" value="Rotation personnel"> Rotation personnel</label>
        </div>
      </div>

      <div class="stack" style="margin-top:12px">
        <label class="chip warn"><input id="filtrage" type="checkbox"> Filtrage mail d√©j√† en place</label>
      </div>

      <div class="stack" style="margin-top:16px">
        <button class="primary" onclick="generer()">G√©n√©rer la reco</button>
        <button class="muted" onclick="resetForm()">R√©initialiser</button>
      </div>
      <div class="foot">Version moteur: <b>2.2</b> ‚Äî r√®gles: exclusivit√© Protect, sensibilisation-only, nudges par segment, filtrage existant.</div>
    </div>

    <div class="panel">
      <h3>R√©sultat</h3>
      <div id="result"></div>
      <div id="scores" style="margin-top:12px"></div>
      <div id="offers" style="margin-top:12px"></div>
      <div id="pitch" style="margin-top:20px;border-top:1px solid rgba(255,255,255,0.1);padding-top:10px"></div>
    </div>
  </div>

<script>
// ---------- Helpers ----------
const any = (arr, set) => arr.some(x => set.includes(x));

function segFromTaille(t){
  if(["1-10","11-50"].includes(t)) return "1-50";
  if(["51-100","101-250"].includes(t)) return "51-250";
  if(t==="250-1000") return "251-1000";
  return "1000+";
}

function getForm(){
  const secteur = document.getElementById('secteur').value;
  const taille = document.getElementById('taille').value;
  const maturite = document.getElementById('maturite').value;
  const budget = document.getElementById('budget').value;
  const contraintes = document.getElementById('contraintes').value;
  const multi = document.getElementById('multi').value;
  const filtrage = document.getElementById('filtrage').checked ? 'Oui':'Non';
  const painpoints = Array.from(document.querySelectorAll('#pp input:checked')).map(x=>x.value);
  const segment = segFromTaille(taille);
  return {secteur, taille, segment, maturite, budget, contraintes, multi, filtrage, painpoints};
}

// ---------- Scoring v2.2 (sans U Cyber) ----------
function scoreAll(ctx){
  const {secteur, taille, segment, maturite, budget, contraintes, multi, filtrage, painpoints} = ctx;
  const yes = (x)=>x==='Oui';
  const S = {Essential:0, Advanced:0, Coach:0, Sikker:0, Academy:0};

  // Essential
  if(["1-10","11-50"].includes(taille)) S.Essential+=3;
  if(["BTP","Commerce","Transport","Industrie"].includes(secteur)) S.Essential+=2;
  if(maturite==="Faible") S.Essential+=2;
  if(budget==="Faible") S.Essential+=2;
  if(any(painpoints,["Phishing","Fraude"])) S.Essential+=1;
  if(multi==="Non") S.Essential+=1;
  if(["101-250","250-1000","1000+"].includes(taille)) S.Essential-=3;
  if(maturite==="√âlev√©e") S.Essential-=2;
  if(contraintes==="Oui") S.Essential-=1;
  if(yes(filtrage)) S.Essential-=3;
  S.Essential += ({"1-50":1,"51-250":0,"251-1000":-1,"1000+":-2})[segment]||0;

  // Advanced
  if(["101-250","250-1000","1000+"].includes(taille)) S.Advanced+=3;
  if(["Sant√©","Finance","√âducation","Administration","√ânergie"].includes(secteur)) S.Advanced+=3;
  if(contraintes==="Oui") S.Advanced+=3;
  if(maturite==="√âlev√©e") S.Advanced+=2;
  if(any(painpoints,["Gouvernance","Ransomware"])) S.Advanced+=2;
  if(multi==="Oui") S.Advanced+=1; // base
  if(["1-10","11-50","51-100"].includes(taille)) S.Advanced-=3;
  if(budget==="Faible") S.Advanced-=2;
  if(multi==="Oui") S.Advanced+=1; // renforc√©
  if(yes(filtrage)) S.Advanced-=3;
  S.Advanced += ({"1-50":-1,"51-250":1,"251-1000":2,"1000+":2})[segment]||0;

  // Coach
  if(any(painpoints,["Phishing","Fraude","Sensibilisation"])) S.Coach+=3;
  if(contraintes==="Oui") S.Coach+=3;
  if(["Sant√©","Finance","Administration","√âducation","Commerce","BTP"].includes(secteur)) S.Coach+=2;
  if(["Moyenne","√âlev√©e"].includes(maturite)) S.Coach+=2;
  if(["11-50","51-100","101-250","250-1000","1000+"].includes(taille)) S.Coach+=1;
  if(budget==="Faible" && ["1-10"].includes(taille)) { if(contraintes!=="Oui") S.Coach-=2; }
  if(["BTP","Commerce"].includes(secteur) && ["1-10","11-50"].includes(taille)) S.Coach+=1;
  if(yes(filtrage)) S.Coach+=1;
  if(["51-250","251-1000"].includes(segment)) S.Coach+=1;
  if(["Sant√©","Administration","√âducation"].includes(secteur)) S.Coach+=1;

  // Sikker
  if(multi==="Oui") S.Sikker+=3;
  if(any(painpoints,["Acc√®s partag√©s","Rotation personnel"])) S.Sikker+=3;
  if(["Industrie","Commerce","BTP","√âducation","Transport"].includes(secteur)) S.Sikker+=2;
  if(["1-10","11-50","51-100","101-250"].includes(taille)) S.Sikker+=2;
  if(maturite==="Moyenne") S.Sikker+=1;
  if(["1000+"].includes(taille)) S.Sikker-=2;
  if(budget==="Faible" && multi==="Oui") S.Sikker+=1;
  if(any(painpoints,["Gouvernance"])) S.Sikker+=1;
  S.Sikker += (segment==="51-250"?2:0) + (segment==="251-1000"?2:0) + (segment==="1000+"?1:0);
  if(["Sant√©","Administration"].includes(secteur)) S.Sikker+=1;

  // Academy
  if(contraintes==="Oui") S.Academy+=3;
  if(["Finance","Sant√©","√âducation","Administration","√ânergie"].includes(secteur)) S.Academy+=3;
  if(["Moyenne","√âlev√©e"].includes(maturite)) S.Academy+=2;
  if(["51-100","101-250","250-1000","1000+"].includes(taille)) S.Academy+=2;
  if(any(painpoints,["Conformit√©","Sensibilisation"])) S.Academy+=1;
  if(["1-10"].includes(taille)) S.Academy-=2;
  if(budget==="Faible") S.Academy-=2;
  if(["BTP","Commerce"].includes(secteur) && ["1-10","11-50"].includes(taille)) S.Academy-=1;
  if(secteur==="√âducation") S.Academy+=1;
  if(painpoints.length>0 && painpoints.every(p=>["Sensibilisation"].includes(p))) S.Academy+=3;
  if(yes(filtrage)) S.Academy+=1;
  S.Academy += (["51-250","251-1000","1000+"].includes(segment)?1:0);
  if(["Sant√©","Administration"].includes(secteur)) S.Academy+=1;

  return S;
}

function exclusiviteProtect(S){
  if(S.Advanced > S.Essential) S.Essential = -999; else S.Advanced = -999;
}

function sensibilisationOnly(painpoints){
  const set = ["Phishing","Fraude","Sensibilisation","Conformit√©"];
  return painpoints.length>0 && painpoints.every(p=>set.includes(p));
}

function cibleParSegment(seg){
  return {"1-50":2, "51-250":3, "251-1000":3, "1000+":3}[seg]||3;
}

function choixBundle(S, ctx){
  const {segment, contraintes, multi, painpoints, filtrage} = ctx;
  if(filtrage==='Oui'){ S.Essential=-999; S.Advanced=-999; }
  exclusiviteProtect(S);
  const entries = Object.entries(S).sort((a,b)=>b[1]-a[1]);
  let picks = entries.filter(([,v])=>v>-999).slice(0,3).map(([k])=>k);
  if(sensibilisationOnly(painpoints)){
    if(!picks.includes('Coach')) picks[2] = 'Coach';
    if(!picks.includes('Academy')) picks[1] = 'Academy';
  }
  const target = cibleParSegment(segment);
  if(picks.length>target) picks = picks.slice(0,target);
  if(picks.length<target){
    const pool = entries.map(([k])=>k).filter(k=>!picks.includes(k) && S[k]>-999);
    const prio = [];
    if(contraintes==='Oui'){ if(!picks.includes('Academy')) prio.push('Academy'); if(!picks.includes('Coach')) prio.push('Coach'); }
    if(multi==='Oui' && !picks.includes('Sikker')) prio.push('Sikker');
    if(any(painpoints,["Ransomware","Gouvernance"]) && !picks.includes('Advanced') && S.Advanced>-999) prio.push('Advanced');
    if(any(painpoints,["Phishing","Fraude"]) && !picks.includes('Coach')) prio.push('Coach');
    for(const k of [...prio, ...pool]){
      if(picks.length>=target) break;
      if(!picks.includes(k)) picks.push(k);
    }
  }
  return picks;
}

function explain(bundle, S, ctx){
  const parts = [];
  if(bundle.includes('Advanced')) parts.push("supervision + conformit√© (reports auditables)");
  if(bundle.includes('Essential') && !bundle.includes('Advanced')) parts.push("filtrage simple, d√©ploiement rapide");
  if(bundle.includes('Coach')) parts.push("r√©duction risque humain (anti-phishing/fraude)");
  if(bundle.includes('Academy')) parts.push("e-learning conformit√© & sensibilisation continue");
  if(bundle.includes('Sikker')) parts.push("gouvernance des acc√®s & mots de passe (multi-sites/prestataires)");

  const warns = [];
  if(!bundle.includes('Advanced') && !bundle.includes('Essential') && any(ctx.painpoints,["Phishing","Fraude"])){
    warns.push("‚ö†Ô∏è Sans filtrage mail, la formation r√©duit le risque humain mais ne bloque pas techniquement les attaques.");
  }
  return {text: parts.join(" ¬∑ "), warns};
}

function offers(bundle, ctx){
  const o=[]; const seg = ctx.segment; const secteur = ctx.secteur; const n=bundle.length;
  if(n===2) o.push("Incentive multi-produit: ‚àí8% pack 2 produits");
  if(n===3) o.push("Incentive multi-produit: ‚àí12% pack 3 produits");
  if(seg==="1-50" && bundle.includes('Essential') && bundle.includes('Coach')){
    o.push("Ajouter Sikker sous 30 jours: 3 mois off (25 si√®ges)");
  }
  if(["51-250","251-1000"].includes(seg) && n===3){
    o.push("Option Academy 3 mois off si adoption ‚â•70% √† M+3");
  }
  if((secteur==="Sant√©" || secteur==="√âducation") && bundle.includes('Academy')){
    o.push("Pilote Academy: 3 mois off pour √©quipe critique");
  }
  if(ctx.filtrage==='Oui' && bundle.includes('Coach') && bundle.includes('Academy')){
    o.push("Filtrage existant: Coach+Academy √† ‚àí15% (compl√©ment p√©dagogique)");
  }
  return o;
}

function generer(){
  const ctx = getForm();
  ctx.segment = segFromTaille(ctx.taille);
  const S = scoreAll(ctx);
  const bundle = choixBundle(S, ctx);
  const {text, warns} = explain(bundle, S, ctx);

  const pretty = Object.entries(S)
    .filter(([,v])=>v>-999)
    .sort((a,b)=>b[1]-a[1])
    .map(([k,v])=>`<div class="card"><div class="k">${k}</div><div class="v">${v}</div></div>`)
    .join('');
  document.getElementById('scores').innerHTML = `<div class="scores">${pretty}</div>`;

  const title = bundle.join(' + ');
  const ofrs = offers(bundle, ctx).map(x=>`<li>${x}</li>`).join('');
  const warnHtml = warns.length?`<div class="panel warn" style="margin-top:10px">${warns.map(w=>`<div>${w}</div>`).join('')}</div>`:'';
  document.getElementById('result').innerHTML = `
    <div class="rec">
      <div class="badg">Bundle recommand√©</div>
      <h2 style="margin:8px 0 6px">${title||'‚Äî'}</h2>
      <div class="hint">${text||''}</div>
    </div>
    ${warnHtml}
  `;
  document.getElementById('offers').innerHTML = ofrs?`<h4>üí° Suggestions d'offre</h4><ul>${ofrs}</ul>`:'';
  document.getElementById('pitch').innerHTML = '<h4>üó£Ô∏è Pitch conseill√©</h4><p class="hint">Ajoute ici tes pitchs par segment/secteur et je les brancherai pour affichage automatique.</p>'
}

function resetForm(){
  document.getElementById('secteur').selectedIndex=0;
  document.getElementById('taille').selectedIndex=0;
  document.getElementById('maturite').selectedIndex=0;
  document.getElementById('budget').selectedIndex=0;
  document.getElementById('contraintes').selectedIndex=0;
  document.getElementById('multi').selectedIndex=0;
  document.getElementById('filtrage').checked=false;
  document.querySelectorAll('#pp input').forEach(i=>{i.checked=false});
  document.getElementById('result').innerHTML='';
  document.getElementById('scores').innerHTML='';
  document.getElementById('offers').innerHTML='';
  document.getElementById('pitch').innerHTML='';
}
</script>
</body>
</html>
